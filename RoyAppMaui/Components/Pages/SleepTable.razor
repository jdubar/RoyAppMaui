@page "/"

@using RoyAppMaui.Models

<MudButton OnClick="AddNewItem" Color="Color.Success" Class="add-item-btn">Add Item</MudButton>
<MudDataGrid T="Sleep"
             EditMode="DataGridEditMode.Form"
             EditTrigger="DataGridEditTrigger.Manual"
             Items="_items"
             Bordered="true"
             Elevation="25"
             ReadOnly="false"
             StartedEditingItem="StartedEditingItem">
    <Columns>
        <PropertyColumn Property="x => x.Id" />
        <PropertyColumn Property="x => x.BedtimeDisplay" Title="Bedtime">
            <EditTemplate>
                <MudTimePicker @ref="_bedtimepicker"
                               Label="Bedtime"
                               Editable="true"
                               Time="context.Item.Bedtime"
                               AmPm="true"
                               Placeholder="hh:mm"
                               TimeFormat="HH:mm"
                               ImmediateText="true"
                               Variant="Variant.Text"
                               PickerClosed="_bedtimepicker.ResetAsync"
                               PickerVariant="PickerVariant.Dialog"
                               TimeChanged="HandleBedTimeChange" />
            </EditTemplate>
        </PropertyColumn>
        <PropertyColumn Property="x => x.BedtimeRec" Title="(As Decimal)" IsEditable="false" />
        <PropertyColumn Property="x => x.WaketimeDisplay" Title="Waketime">
            <EditTemplate>
                <MudTimePicker @ref="_waketimepicker"
                               Label="Waketime"
                               Editable="true"
                               Time="context.Item.Waketime"
                               AmPm="true"
                               Placeholder="hh:mm"
                               TimeFormat="HH:mm"
                               ImmediateText="true"
                               Variant="Variant.Text"
                               PickerClosed="_waketimepicker.ResetAsync"
                               PickerVariant="PickerVariant.Dialog"
                               TimeChanged="HandleWakeTimeChange" />
            </EditTemplate>
        </PropertyColumn>
        <PropertyColumn Property="x => x.WaketimeRec" Title="(As Decimal)" IsEditable="false" />
        <PropertyColumn Property="x => x.Duration" IsEditable="false" />
        <TemplateColumn CellClass="d-flex justify-center">
            <CellTemplate>
                <MudIconButton Size="@Size.Small" Icon="@Icons.Material.Filled.Edit" OnClick="@context.Actions.StartEditingItemAsync" />
                <MudIconButton Size="@Size.Small" Icon="@Icons.Material.Filled.Delete" OnClick="@(() => RemoveItem(context))" />
            </CellTemplate>
        </TemplateColumn>
    </Columns>
</MudDataGrid>
